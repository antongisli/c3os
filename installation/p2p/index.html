<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.91.2" />
    <meta name="description" content="Documentation for c3os">
<meta name="author" content="Ettore Di Giacinto">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Full P2P mesh support :: c3os documentation</title>

    
    <link href="/css/nucleus.css?1663020486" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1663020486" rel="stylesheet">
    <link href="/css/hybrid.css?1663020486" rel="stylesheet">
    <link href="/css/featherlight.min.css?1663020486" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1663020486" rel="stylesheet">
    <link href="/css/auto-complete.css?1663020486" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1663020486" rel="stylesheet">
    <link href="/css/theme.css?1663020486" rel="stylesheet">
    <link href="/css/tabs.css?1663020486" rel="stylesheet">
    <link href="/css/hugo-theme.css?1663020486" rel="stylesheet">
    
    <link href="/css/theme-blue.css?1663020486" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1663020486"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/installation/p2p/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      
<a href="https://docs.c3os.io">
<img src="https://user-images.githubusercontent.com/2420543/153508410-a806a385-ae3e-417e-b87e-7472f21689e3.png">
</a>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1663020486"></script>
<script type="text/javascript" src="/js/auto-complete.js?1663020486"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/docs.c3os.io";
    
</script>
<script type="text/javascript" src="/js/search.js?1663020486"></script>

    
  </div>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/quickstart/" title="Quickstart" class="dd-item
        
        
        
        ">
      <a href="/quickstart/">
          Quickstart
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/quickstart/installation/" title="Installation" class="dd-item ">
        <a href="/quickstart/installation/">
        Installation
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/installation/" title="Installation reference" class="dd-item
        parent
        
        
        ">
      <a href="/installation/">
          Installation reference
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/installation/manual/" title="Manual installation" class="dd-item ">
        <a href="/installation/manual/">
        <b>- </b>Manual installation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/installation/interactive/" title="Interactive installation" class="dd-item ">
        <a href="/installation/interactive/">
        <b>- </b>Interactive installation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/installation/automated/" title="Automated installation" class="dd-item ">
        <a href="/installation/automated/">
        <b>- </b>Automated installation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/installation/p2p/" title="Full P2P mesh support" class="dd-item active">
        <a href="/installation/p2p/">
        <b>- </b>Full P2P mesh support
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/installation/raspberry/" title="Raspberry" class="dd-item ">
        <a href="/installation/raspberry/">
        <b>- </b>Raspberry
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/installation/takeover/" title="Take over installation" class="dd-item ">
        <a href="/installation/takeover/">
        <b>- </b>Take over installation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/installation/netboot/" title="Netboot installation" class="dd-item ">
        <a href="/installation/netboot/">
        <b>- </b>Netboot installation
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/upgrade/" title="Upgrade" class="dd-item
        
        
        
        ">
      <a href="/upgrade/">
          Upgrade
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/upgrade/manual/" title="Manual" class="dd-item ">
        <a href="/upgrade/manual/">
        <b>- </b>Manual
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/upgrade/kubernetes/" title="Upgrading from Kubernetes" class="dd-item ">
        <a href="/upgrade/kubernetes/">
        <b>- </b>Upgrading from Kubernetes
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/architecture/" title="Architecture" class="dd-item
        
        
        
        ">
      <a href="/architecture/">
          Architecture
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/architecture/container/" title="Container based OS" class="dd-item ">
        <a href="/architecture/container/">
        <b>- </b>Container based OS
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/architecture/immutable/" title="Immutable layout" class="dd-item ">
        <a href="/architecture/immutable/">
        <b>- </b>Immutable layout
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/architecture/meta/" title="Meta-Distribution" class="dd-item ">
        <a href="/architecture/meta/">
        <b>- </b>Meta-Distribution
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/architecture/network/" title="P2P Network" class="dd-item ">
        <a href="/architecture/network/">
        <b>- </b>P2P Network
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/examples/" title="Examples" class="dd-item
        
        
        
        ">
      <a href="/examples/">
          Examples
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/examples/examples/" title="Common setup" class="dd-item ">
        <a href="/examples/examples/">
        <b>- </b>Common setup
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/examples/configuration/" title="Configuring a node after install" class="dd-item ">
        <a href="/examples/configuration/">
        <b>- </b>Configuring a node after install
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/reference/" title="Reference" class="dd-item
        
        
        
        ">
      <a href="/reference/">
          Reference
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/reference/paths/" title="Paths" class="dd-item ">
        <a href="/reference/paths/">
        <b>- </b>Paths
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/reference/cli/" title="CLI" class="dd-item ">
        <a href="/reference/cli/">
        <b>- </b>CLI
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/reference/troubleshooting/" title="Troubleshooting" class="dd-item ">
        <a href="/reference/troubleshooting/">
        <b>- </b>Troubleshooting
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/reference/configuration/" title="Configuration reference" class="dd-item ">
        <a href="/reference/configuration/">
        <b>- </b>Configuration reference
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/reference/recovery_mode/" title="Remote Recovery mode" class="dd-item ">
        <a href="/reference/recovery_mode/">
        <b>- </b>Remote Recovery mode
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/reference/customizing/" title="Customizing the system image" class="dd-item ">
        <a href="/reference/customizing/">
        <b>- </b>Customizing the system image
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://github.com/c3os-io/c3os"><i class='fab fa-fw fa-github'></i> Github</a>
              </li>
          
              <li>
                  <a class="padding" href="https://github.com/c3os-io/c3os/discussions"><i class='fas fa-fw fa-comments'></i> Github discussions</a>
              </li>
          
              <li>
                  <a class="padding" href="https://web.libera.chat/#c3os"><i class='fas fa-fw fa-comments'></i> Libera chat</a>
              </li>
          
              <li>
                  <a class="padding" href="https://matrix.to/#/#c3os:matrix.org"><i class='fas fa-fw fa-comments'></i> Matrix chat</a>
              </li>
          
              <li>
                  <a class="padding" href="https://github.com/c3os-io/provider-c3os/releases"><i class='fas fa-solid fa-download'></i> Download</a>
              </li>
          
              <li>
                  <a class="padding" href="https://github.com/c3os-io/c3os/releases"><i class='fas fa-solid fa-download'></i> Download core (without k3s)</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/c3os-io/c3os/edit/master/docs/content/installation/p2p.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'></a> > <a href='/installation/'>Installation reference</a> > Full P2P mesh support
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#prerequisites">Prerequisites</a></li>
    <li><a href="#configuration">Configuration</a>
      <ul>
        <li><a href="#network_token"><code>network_token</code></a></li>
        <li><a href="#network_id"><code>network_id</code></a></li>
        <li><a href="#role"><code>role</code></a></li>
      </ul>
    </li>
    <li><a href="#join-new-nodes">Join new nodes</a></li>
    <li><a href="#connect-to-the-nodes">Connect to the nodes</a></li>
    <li><a href="#get-kubeconfig">Get kubeconfig</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Full P2P mesh support
            </h1>
          

        



<div class="notices note" ><p>This feature is crazy and experimental!</p>
</div>

<p>This section will guide on how to leverage the p2p full-mesh capabilities of c3os.</p>
<p>c3OS supports p2p full-mesh out of the box. That allows to seamelessly interconnect clusters and nodes from different regions into an unified overlay network,
additionally, the same network is used for co-ordinating nodes automatically, allowing self-automated node bootstrap.</p>
<p>A hybrid network is automatically set up between all the nodes, as such there is no need to expose them over the Internet, and either expose the Kubernetes management API outside, reducing attacker&rsquo;s exploiting surface.</p>
<p>C3os can be configured to automatically bootstrap a kubernetes cluster with the full-mesh functionalities, or just either add an additional interface to the machines to let them communicate within a new network segment.</p>
<p>If you are not familiar with the process, it is suggested to follow the <a href="/quickstart/installation">quickstart</a> first, and the steps below in sequence.
The section below just explains the difference in the configuration options to enable p2p full-mesh during the installation phase.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li><code>c3os-cli</code></li>
</ul>
<h2 id="configuration">Configuration</h2>
<p>In order to configure a node to join over the same p2p network during installation add a <code>c3os</code> block in the configuration, like the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">c3os</span>:
  <span style="color:#f92672">network_token</span>: <span style="color:#e6db74">&#34;....&#34;</span>
  <span style="color:#75715e"># Optionally, set a network id (for multiple clusters in the same network)</span>
  <span style="color:#75715e"># network_id: &#34;dev&#34;</span>
  <span style="color:#75715e"># Optionally set a role</span>
  <span style="color:#75715e"># role: &#34;master&#34;</span>

</code></pre></div><p>The <code>c3os</code> block is used to configure settings to the mesh functionalities. The minimum required argument is the <code>network_token</code>.</p>
<h3 id="network_token"><code>network_token</code></h3>
<p>The <code>network_token</code> is a unique, shared secret which is spread over the nodes and can be generated with the <code>c3os-cli</code>.
It will make all the node connect automatically to the same network. Every node will generate a set of private/public key keypair automatically on boot that are used to communicate securely within a e2e encrypted channel.</p>
<p>To generate a new network token, you can use the <code>c3os-cli</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">c3os generate-token
</code></pre></div><h3 id="network_id"><code>network_id</code></h3>
<p>An optional, unique identifier for the cluster. This allows to bootstrap multiple cluster over the same underlaying network.</p>
<h3 id="role"><code>role</code></h3>
<p>Force a role for the node. Available: <code>worker</code>, <code>master</code>.</p>
<p>For a full reference of all the supported use cases, see <a href="https://rancher.github.io/elemental-toolkit/docs/reference/cloud_init/">cloud-init</a>.</p>
<h2 id="join-new-nodes">Join new nodes</h2>
<p>To join new nodes, simply re-apply the process to new nodes by specifying the same <code>config.yaml</code> for all the machines. Unless you have specified a role for each of the nodes, the configuration doesn&rsquo;t need any further change. The machines will connect automatically between themselves, either remotely on local network.</p>
<h2 id="connect-to-the-nodes">Connect to the nodes</h2>
<p>The <code>c3os-cli</code> can be used to establish a tunnel with the nodes network given a <code>network_token</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo c3os bridge --network-token &lt;TOKEN&gt;
</code></pre></div><p>This command will create a tun device in your machine and will make possible to contact each node in the cluster.</p>

<div class="notices note" ><p>The command requires root permissions in order to create a tun/tap device on the host</p>
</div>

<p>An API will be also available at <a href="http://localhost:8080">localhost:8080</a> for inspecting the network status.</p>
<h2 id="get-kubeconfig">Get kubeconfig</h2>
<p>To get the kubeconfig it is sufficient or either login to the master node and get it from the engine ( e.g. k3s puts it <code>/etc/rancher/k3s/k3s.yaml</code>) or using the <code>c3os</code> cli.</p>
<p>By using the CLI, you need to be connected to the bridge, or either logged in from one of the nodes and perform the commands in the console.</p>
<p>If you are using the CLI, you need to run the bridge in a separate window.</p>
<p>To get the kubeconfig, run the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">c3os get-kubeconfig &gt; kubeconfig
</code></pre></div>
<div class="notices note" ><p><code>c3os bridge</code> acts like <code>kubectl proxy</code>. you need to keep it open to operate the kubernetes cluster and access the API.</p>
</div>



<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/installation/automated/" title="Automated installation"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/installation/raspberry/" title="Raspberry" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1663020486"></script>
    <script src="/js/perfect-scrollbar.min.js?1663020486"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1663020486"></script>
    <script src="/js/jquery.sticky.js?1663020486"></script>
    <script src="/js/featherlight.min.js?1663020486"></script>
    <script src="/js/highlight.pack.js?1663020486"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1663020486"></script>
    <script src="/js/learn.js?1663020486"></script>
    <script src="/js/hugo-learn.js?1663020486"></script>
    
        
            <script src="/mermaid/mermaid.js?1663020486"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

